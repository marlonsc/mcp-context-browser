# MCP Context Browser Validation Configuration
# Rename to .mcb-validate.toml to use

[general]
# Patterns to exclude from validation
exclude_patterns = ["target/", "tests/fixtures/"]

# Additional source paths beyond crates/ (for legacy code)
# additional_src_paths = ["../legacy-src"]

# Output format: "human", "json", "ci"
output_format = "human"

# ==============================================================================
# Architecture Rules
# ==============================================================================
[rules.architecture]
enabled = true
severity = "Error"

[rules.architecture.layer_boundaries]
# Domain layer must have no internal mcb-* dependencies
domain_internal_deps = []

# Application layer only depends on domain
application_internal_deps = ["mcb-domain"]

# Providers layer depends on domain and application
providers_internal_deps = ["mcb-domain", "mcb-application"]

# Infrastructure layer depends on domain, application, and providers
infrastructure_internal_deps = ["mcb-domain", "mcb-application", "mcb-providers"]

# Server layer must NOT depend on providers directly (access via infrastructure)
server_internal_deps = ["mcb-domain", "mcb-application", "mcb-infrastructure"]

# ==============================================================================
# Code Quality Rules
# ==============================================================================
[rules.quality]
enabled = true

# Maximum lines per file before warning
max_file_lines = 500

# Maximum lines per function before warning
max_function_lines = 50

# Allow unwrap/expect in test code
allow_unwrap_in_tests = true

# Allow expect() with descriptive message (stricter than raw unwrap)
allow_expect_with_message = true

# Files exempt from unwrap/expect checks
exempt_patterns = []

# ==============================================================================
# Organization Rules
# ==============================================================================
[rules.organization]
enabled = true

# Magic numbers that are allowed (common sizes, time constants)
magic_number_allowlist = [
    0, 1, 2, 10, 100, 1000,  # Common constants
    16384, 32768, 65536,     # Buffer sizes
    86400, 3600, 60          # Time constants (day, hour, minute in seconds)
]

# Enforce strict directory structure
strict_directory_structure = true

# ==============================================================================
# SOLID Principles Rules
# ==============================================================================
[rules.solid]
enabled = true

# Maximum methods per trait (Interface Segregation Principle)
max_trait_methods = 10

# Maximum methods per impl block (Single Responsibility Principle)
max_impl_methods = 15

# Maximum match arms before suggesting polymorphism (Open/Closed Principle)
max_match_arms = 10

# Maximum parameters per function
max_function_params = 5

# ==============================================================================
# Shaku/DI Rules
# ==============================================================================
[rules.shaku]
enabled = true

# Require #[derive(Component)] for port implementations
require_component_derive = true

# Require #[shaku(interface = ...)] annotation
require_interface_annotation = true

# Allow direct service construction in test code
allow_direct_construction_in_tests = true

# ==============================================================================
# Validator Enable/Disable Flags
# ==============================================================================
[validators]
dependency = true
organization = true
quality = true
solid = true
shaku = true
architecture = true
refactoring = true
naming = true
documentation = true
patterns = true
kiss = true
tests = true
async_patterns = true
error_boundary = true
performance = true
implementation = true
pmat = true
clean_architecture = true
