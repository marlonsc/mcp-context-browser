# MCP Context Browser - Default Configuration
# Only essential parameters are specified here.
# All other parameters use sensible defaults from the code.
# See docs/CONFIGURATION_DEFAULTS.md for complete reference.
#
# Last Updated: 2026-01-12

# ============================================================================
# APPLICATION - Metadata
# ============================================================================
name = "MCP Context Browser"
version = "0.1.0"

# ============================================================================
# SERVER - Core Network Settings
# ============================================================================
[server]
host = "0.0.0.0"          # Listen on all interfaces
port = 3000               # MCP server port

# ============================================================================
# METRICS & MONITORING - HTTP Server for Admin Dashboard
# ============================================================================
[metrics]
enabled = true            # Enable metrics/admin HTTP server
port = 3001               # HTTP server port (dashboard, metrics, health)

# Rate limiting configuration
[metrics.rate_limiting]
enabled = false           # Disable rate limiting by default
window_seconds = 60       # Rate limit window
max_requests_per_window = 1000  # Requests per window
burst_allowance = 100     # Burst allowance

# Rate limiting backend (in-memory or redis)
[metrics.rate_limiting.backend]
type = "memory"           # Use in-memory backend for rate limiting

# ============================================================================
# DATABASE - Optional SQL Database Configuration
# ============================================================================
[database]
enabled = false           # Enable database integration
url = ""                  # Database connection URL (PostgreSQL recommended)
max_connections = 20      # Maximum connection pool size
min_idle = 5              # Minimum idle connections
max_lifetime = 1800       # Maximum connection lifetime (seconds, default: 1800 = 30 minutes)
idle_timeout = 600        # Idle timeout before closing (seconds, default: 600 = 10 minutes)
connection_timeout = 30   # Connection timeout (seconds, default: 30)

# ============================================================================
# AUTHENTICATION - API Access Control
# ============================================================================
[auth]
enabled = false           # Enable authentication (JWT)
jwt_secret = ""           # JWT signing secret (empty when disabled)
jwt_expiration = 86400    # Token expiration in seconds (24 hours)
jwt_issuer = "mcp-context-browser"  # JWT issuer claim
bypass_paths = ["/health", "/metrics"]  # Paths that bypass authentication

# ============================================================================
# ADMIN INTERFACE - Dashboard & Web UI
# ============================================================================
[admin]
enabled = true            # Enable admin dashboard
jwt_expiration = 3600     # Token expiration in seconds (1 hour)
# SECURITY: Credentials MUST be set via environment variables:
#   MCP_ADMIN_USERNAME - Admin username (required)
#   MCP_ADMIN_PASSWORD - Admin password (min 8 chars, required)
#   MCP_ADMIN_JWT_SECRET - JWT signing secret (min 32 chars, required)
# The server will fail to start if these are not set when admin is enabled.

# ============================================================================
# EMBEDDING PROVIDERS - AI Model for Semantic Search
# ============================================================================
# DEFAULT: fastembed (lightweight, works offline, no external service needed)
# FastEmbed is the default because it's self-contained and always available
[providers.embedding]
provider = "fastembed"    # Use FastEmbed by default (lightweight, local)
model = "BAAI/bge-small-en-v1.5"  # FastEmbed default model
# Optional parameters:
# dimensions = 384                   # FastEmbed default dimensions (defaults to 384)

# ============================================================================
# VECTOR STORE - Where Embeddings are Stored
# ============================================================================
# DEFAULT: filesystem (lightweight, works offline, no external service needed)
# Filesystem is the default because it's self-contained and always available
[providers.vector_store]
provider = "filesystem"               # Use filesystem for vector storage (local, no external service)
# address = "./data/vectors"         # Default filesystem path (relative to working directory)

# ============================================================================
# HYBRID SEARCH - Combined BM25 + Vector Search
# ============================================================================
[hybrid_search]
enabled = true            # Enable hybrid search
bm25_weight = 0.4         # Weight for BM25 text search (0-1)
semantic_weight = 0.6     # Weight for vector similarity search (0-1)
bm25_k1 = 1.2             # BM25 k1 parameter (affects term saturation)
bm25_b = 0.75             # BM25 b parameter (field length normalization)

# ============================================================================
# CACHE - Performance Caching Layer
# ============================================================================
[cache]
enabled = true                    # Enable caching

# Cache backend configuration
[cache.backend]
type = "local"                    # Use local Moka cache (default, recommended)
                                  # Change to "redis" for distributed caching

# Local cache settings (used when type = "local")
[cache.backend.config]
max_entries = 10000               # Maximum number of entries
default_ttl_seconds = 3600        # Default time-to-live (1 hour)

# Redis cache settings (used when type = "redis")
# Uncomment and set URL when using Redis backend:
# [cache.backend]
# type = "redis"
# [cache.backend.config]
# url = "redis://localhost:6379"
# pool_size = 10
# default_ttl_seconds = 3600

# Cache namespace-specific settings (all use code defaults if not specified)
[cache.namespaces.embeddings]
ttl_seconds = 7200              # Cache embeddings for 2 hours
max_entries = 5000
compression = true

[cache.namespaces.search_results]
ttl_seconds = 1800              # Cache search results for 30 minutes
max_entries = 2000
compression = false

[cache.namespaces.metadata]
ttl_seconds = 3600              # Cache metadata for 1 hour
max_entries = 1000
compression = false

[cache.namespaces.provider_responses]
ttl_seconds = 300               # Cache provider responses for 5 minutes
max_entries = 3000
compression = true

[cache.namespaces.sync_batches]
ttl_seconds = 86400             # Keep sync batches for 24 hours
max_entries = 1000
compression = false

# ============================================================================
# DAEMON - Background Process Configuration
# ============================================================================
[daemon]
cleanup_interval_secs = 30        # How often to clean up locks (seconds)
monitoring_interval_secs = 30     # How often to monitor health (seconds)
max_lock_age_secs = 300           # Max age of lock before cleanup (seconds)

# ============================================================================
# DATA DIRECTORIES - XDG Standard Locations
# ============================================================================
# All data (snapshots, history, encryption keys, circuit breakers, etc.)
# Default: ~/.local/share/mcp-context-browser/ (XDG_DATA_HOME standard)
# These are the base directories where all application state is stored
[data]
# Base data directory - all application state stored here
# Uses XDG standard: ~/.local/share/mcp-context-browser/
# Can override with environment variable: MCP__DATA__BASE_DIR
base_dir = "~/.local/share/mcp-context-browser"

# Optional: Override individual subdirectories (uncomment to customize)
# snapshots_dir = "~/.local/share/mcp-context-browser/snapshots"
# config_history_dir = "~/.local/share/mcp-context-browser/config-history"
# encryption_keys_dir = "~/.local/share/mcp-context-browser/encryption"
# circuit_breakers_dir = "~/.local/share/mcp-context-browser/circuit-breakers"

# ============================================================================
# SYNCHRONIZATION - File Watching & Indexing
# ============================================================================
[sync]
interval_ms = 900000              # Full sync interval (15 minutes)
debounce_ms = 60000               # Debounce for file watches (60 seconds)

# ============================================================================
# RESOURCE LIMITS - Protect against resource exhaustion
# ============================================================================
[resource_limits]
enabled = true

[resource_limits.memory]
max_usage_percent = 85.0
max_per_operation = 536870912  # 512MB
warning_threshold = 75.0

[resource_limits.cpu]
max_usage_percent = 80.0
warning_threshold = 70.0

[resource_limits.disk]
max_usage_percent = 90.0
min_free_space = 1073741824  # 1GB
warning_threshold = 80.0

[resource_limits.operations]
max_concurrent_indexing = 4
max_concurrent_search = 10
max_concurrent_embedding = 5
max_queue_size = 100

# ============================================================================
# BELOW: ALL PARAMETERS USE CODE DEFAULTS
# ============================================================================
# Uncomment and modify only if you need custom values:

# [database]
# enabled = false
# url = ""                                    # Leave empty to disable
# max_connections = 20
# min_idle = 5
# max_lifetime = 1800                        # seconds
# idle_timeout = 600                         # seconds
# connection_timeout = 30                    # seconds

# [auth]
# enabled = false
# jwt_expiration = 86400                     # 24 hours
# jwt_issuer = "mcp-context-browser"

# [resource_limits]
# enabled = true
# [resource_limits.memory]
# max_usage_percent = 85.0
# max_per_operation = 536870912             # 512MB
# warning_threshold = 75.0
# [resource_limits.cpu]
# max_usage_percent = 80.0
# warning_threshold = 70.0
# [resource_limits.disk]
# max_usage_percent = 90.0
# min_free_space = 1073741824               # 1GB
# warning_threshold = 80.0
# [resource_limits.operations]
# max_concurrent_indexing = 3
# max_concurrent_search = 10
# max_concurrent_embedding = 5
# max_queue_size = 100
