schema: "rule/v1"
id: "SOLID003"
name: "Match Arm Complexity"
category: "solid"
severity: "info"
enabled: true
engine: "rust-rule-engine"

description: "Match expression has too many arms"
rationale: "Consider using polymorphism or strategy pattern"

patterns:
  match_keyword: '\bmatch\b'
  match_arrow: '=>'
  panic_macros: '(panic!|todo!|unimplemented!)'
  impl_only_decl: 'impl(?:<[^>]*>)?\s+([A-Z][a-zA-Z0-9_]*)'
  string_match: 'match\s+\w+\.as_str\(\)|match\s+[&]?\w+\s*\{\s*"[^"]+"\s*=>'
  string_arm: '^\s*"[^"]+"\s*=>'

config:
  max_arms: 10
  exclude_patterns: ["**/tests/**"]

rule: |
  rule MatchComplexity "Check match arm count" {
      when
          AST.MatchExpression(arm_count > ${max_arms}) &&
          !TestMatch()
      then
          Violation("Match expression has too many arms (${arm_count}), max is ${max_arms}");
  }