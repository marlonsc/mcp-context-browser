schema: "rule/v1"
id: "CA009"
name: "Infrastructure Must Not Import Application"
category: "architecture"
severity: "error"
enabled: true
engine: "rusty-rules"

description: "Infrastructure layer should NOT depend on Application layer"

patterns:
  app_import: 'use\s+mcb_application(?:::|;)'
  app_import_path: 'use\s+(mcb_application::\S+)'
rationale: |
  Per Clean Architecture, infrastructure layer (mcb-infrastructure) should only
  depend on mcb-domain (for port traits).

  It should NOT depend on mcb-application, mcb-providers, or mcb-server as this
  creates circular dependencies and layer violations.

fix_guidance: |
  1. If importing port traits: Move them to mcb-domain/src/ports/
  2. If importing services: Use DI with Arc<dyn ServiceTrait>
  3. If importing registry: Access via mcb-providers, not directly

crate_name: "mcb-infrastructure"
forbidden_imports:
  - "mcb_application"

rule: |
  rule InfrastructureNoApplication "Infrastructure Must Not Import Application" {
      when
          Crate(name == "mcb-infrastructure") &&
          Import(path starts_with "mcb_application")
      then
          Violation("Infrastructure layer cannot depend on Application layer - violates Clean Architecture");
  }
