{% import "icons.html" as icons %}
<!DOCTYPE html>
<html lang="en" x-data="{ sidebarOpen: false }" :class="{ 'dark': localStorage.getItem('theme') === 'dark' }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MCP Context Browser - Admin{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/admin.css">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/admin.js"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen font-sans antialiased">

{# Nav link macro - uses CSS classes from admin.css #}
{% macro nav_link(icon, href, target_page, label, mobile=false) %}
{% if mobile %}
<a href="{{ href | safe }}" class="mobile-nav-link {% if page == target_page %}active{% endif %}">
    {{ icons::icon(name=icon, class="icon") }}{{ label }}
</a>
{% else %}
<a href="{{ href | safe }}" class="nav-link {% if page == target_page %}active{% endif %}">
    {{ icons::icon(name=icon, class="icon") }}{{ label }}
</a>
{% endif %}
{% endmacro nav_link %}

<!-- Navigation Bar -->
<nav class="navbar">
    <div class="nav-container">
        <!-- Brand -->
        <div class="flex items-center gap-2">
            <button @click="sidebarOpen = !sidebarOpen" class="icon-btn md:hidden">
                {{ icons::icon(name="menu", class="icon-lg") }}
            </button>
            <a href="/dashboard" class="nav-brand">
                {{ icons::icon(name="search", class="icon-lg text-primary") }}
                <span>MCP Context Browser</span>
                <span class="version-badge">v0.1.0</span>
            </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="nav-links hidden md:flex">
            {{ self::nav_link(icon="dashboard", href="/dashboard", target_page="dashboard", label="Dashboard") }}
            {{ self::nav_link(icon="providers", href="/providers", target_page="providers", label="Providers") }}
            {{ self::nav_link(icon="indexes", href="/indexes", target_page="indexes", label="Indexes") }}
            {{ self::nav_link(icon="config", href="/config", target_page="config", label="Config") }}
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-2">
            <button @click="document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light')" class="icon-btn" title="Toggle theme">
                {{ icons::icon(name="moon", class="icon") }}
            </button>
            <form method="post" action="/admin/auth/logout">
                <button type="submit" class="icon-btn" title="Logout">
                    {{ icons::icon(name="logout", class="icon") }}
                </button>
            </form>
        </div>
    </div>
</nav>

<!-- Mobile Sidebar -->
<div x-show="sidebarOpen" x-transition.opacity class="sidebar-backdrop md:hidden" @click="sidebarOpen = false"></div>
<div x-show="sidebarOpen" x-transition:enter="transform transition-transform duration-300" x-transition:enter-start="-translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="transform transition-transform duration-300" x-transition:leave-start="translate-x-0" x-transition:leave-end="-translate-x-full" class="sidebar md:hidden" x-cloak>
    <div class="sidebar-header">
        <span class="font-semibold text-gray-900 dark:text-white">Menu</span>
        <button @click="sidebarOpen = false" class="icon-btn">
            {{ icons::icon(name="close", class="icon") }}
        </button>
    </div>
    <nav class="p-4 flex flex-col gap-1">
        {{ self::nav_link(icon="dashboard", href="/dashboard", target_page="dashboard", label="Dashboard", mobile=true) }}
        {{ self::nav_link(icon="providers", href="/providers", target_page="providers", label="Providers", mobile=true) }}
        {{ self::nav_link(icon="indexes", href="/indexes", target_page="indexes", label="Indexes", mobile=true) }}
        {{ self::nav_link(icon="config", href="/config", target_page="config", label="Config", mobile=true) }}
    </nav>
</div>

<!-- Main Content -->
<main class="main-content">{% block content %}{% endblock %}</main>

<!-- Toast Container -->
<div class="toast-container" x-data>
    <template x-for="(t, i) in $store.toast.items" :key="t.id">
        <div class="toast" :class="{'toast-success': t.type==='success', 'toast-error': t.type==='error', 'toast-warning': t.type==='warning', 'toast-info': t.type==='info'}" x-show="t.show" x-transition @click="$store.toast.remove(t.id)">
            <div class="toast-body">
                <template x-if="t.type === 'success'">{{ icons::icon(name="success", class="icon text-success flex-shrink-0") }}</template>
                <template x-if="t.type === 'error'">{{ icons::icon(name="error", class="icon text-danger flex-shrink-0") }}</template>
                <template x-if="t.type === 'warning'">{{ icons::icon(name="warning", class="icon text-warning flex-shrink-0") }}</template>
                <template x-if="t.type === 'info'">{{ icons::icon(name="info", class="icon text-info flex-shrink-0") }}</template>
                <div class="toast-content">
                    <p class="toast-title" x-text="t.title"></p>
                    <p class="toast-message" x-text="t.message"></p>
                </div>
            </div>
        </div>
    </template>
</div>

{% block scripts %}{% endblock %}
</body>
</html>
