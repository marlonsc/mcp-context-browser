{% extends "base.html" %}
{% import "icons.html" as icons %}
{% block title %}Data Management - MCP Context Browser{% endblock %}

{% block content %}
<div x-data="dataManagement()" class="space-y-6">
    <div class="page-header">
        <div>
            <h1 class="page-title">Data Management</h1>
            <p class="page-description">{{ page_description }}</p>
        </div>
        <button @click="createBackup()" class="btn btn-primary">
            {{ icons::icon(name="download", class="icon-sm") }}
            Create Backup
        </button>
    </div>

    <!-- Backup List -->
    <div class="card">
        <div class="card-header">
            <h3 class="font-medium flex items-center gap-2">
                {{ icons::icon(name="database-stack", class="icon-sm") }}
                Available Backups
            </h3>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Created</th>
                    <th>Size</th>
                    <th>Status</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% if backups %}
                    {% for backup in backups %}
                    <tr>
                        <td class="font-medium">{{ backup.name }}</td>
                        <td>{{ backup.created_at | date(format="%Y-%m-%d %H:%M") }}</td>
                        <td>{{ backup.size_bytes | filesizeformat }}</td>
                        <td><span class="badge badge-success">{{ backup.status }}</span></td>
                        <td class="text-right">
                            <button class="btn btn-ghost btn-sm">Restore</button>
                            <button class="btn btn-ghost btn-sm text-danger">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="5" class="text-center p-4 text-muted">No backups available</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Create Backup Form -->
    <div class="card">
        <div class="card-header">
            <h3 class="font-medium flex items-center gap-2">
                {{ icons::icon(name="plus", class="icon-sm") }}
                Create New Backup
            </h3>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="input-label">Backup Name</label>
                    <input type="text" x-model="form.name" placeholder="e.g., daily_backup_2024" class="input">
                </div>
                <div>
                    <label class="input-label">Backup Type</label>
                    <select x-model="form.type" class="input">
                        <option value="full">Full Backup</option>
                        <option value="config">Configuration Only</option>
                        <option value="data">Data Only</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 space-y-2">
                <label class="flex items-center gap-2">
                    <input type="checkbox" x-model="form.includeConfig" class="checkbox"> Include configuration
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" x-model="form.includeVectorData" class="checkbox"> Include vector data
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" x-model="form.compress" class="checkbox"> Compress backup
                </label>
            </div>
            <div class="mt-6">
                <button @click="startBackup()" class="btn btn-primary">Start Backup</button>
            </div>
        </div>
    </div>

    <!-- Warning -->
    <div class="card">
        <div class="card-header">
            <h3 class="font-medium flex items-center gap-2">
                {{ icons::icon(name="refresh", class="icon-sm") }}
                Restore Operations
            </h3>
        </div>
        <div class="card-body">
            <div class="alert alert-warning flex items-start gap-3">
                {{ icons::icon(name="warning", class="icon flex-shrink-0 text-warning") }}
                <p class="text-sm">
                    Restoring from backup will stop the service temporarily and may take several minutes.
                </p>
            </div>
            <p class="mt-4 text-center text-muted">Select a backup from the list above to restore</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function dataManagement() {
    return {
        form: { name: '', type: 'full', includeConfig: true, includeVectorData: true, compress: false },

        async startBackup() {
            try {
                await API.post('/admin/backup', this.form);
                toast.success('Backup started');
            } catch (e) { toast.error(e.message); }
        },

        async createBackup() { this.startBackup(); }
    };
}
</script>
{% endblock %}
