apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: mcb
  labels:
    app: mcb

# Common labels applied to all resources
commonLabels:
  app: mcb
  version: v0.1.1

# Resources to include
resources:
  - rbac.yaml
  - configmap.yaml
  - secrets.yaml
  - service.yaml
  - deployment.yaml
  - hpa.yaml
  - ingress.yaml
  - networkpolicy.yaml
  - poddisruptionbudget.yaml
  - servicemonitor.yaml

# Image transformations
images:
  - name: mcb
    newTag: v0.1.1

# ConfigMap generator for environment-specific configs
configMapGenerator:
  - name: mcp-config-env
    literals:
      - ENVIRONMENT=production
      - LOG_LEVEL=info

# Secret generator (populate with actual values)
secretGenerator:
  - name: mcp-redis-secret
    literals:
      - redis-url=redis://localhost:6379
    type: Opaque
  - name: mcp-database-secret
    literals:
      - database-url=postgresql://user:pass@localhost:5432/mcp
    type: Opaque
  - name: mcp-encryption-secret
    literals:
      - master-key=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
    type: Opaque
  - name: mcp-auth-secret
    literals:
      - jwt-secret=supersecretjwtkey12345678901234567890
    type: Opaque
  - name: mcp-providers-secret
    literals:
      - openai-api-key=sk-your-openai-key-here
      - gemini-api-key=your-gemini-key-here
    type: Opaque

# Namespace for all resources
namespace: mcp-system

# Replicas override
replicas:
  - name: mcb
    count: 3

# Resource patches for different environments
patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mcb
    spec:
      template:
        spec:
          containers:
          - name: mcb
            env:
            - name: ENVIRONMENT
              valueFrom:
                configMapKeyRef:
                  name: mcp-config-env
                  key: ENVIRONMENT

# JSON patches for advanced modifications
patches:
  - target:
      kind: Ingress
      name: mcb-ingress
    patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: api.mcp-prod.example.com

# Transformers for common modifications
transformers:
  - |-
    apiVersion: builtin
    kind: LabelTransformer
    metadata:
      name: label-transformer
    labels:
      environment: production
      team: ai-platform
    fieldSpecs:
    - path: metadata/labels
      create: true
      kind: Deployment
    - path: metadata/labels
      create: true
      kind: Service
    - path: metadata/labels
      create: true
      kind: ConfigMap